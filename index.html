<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Registration</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 24px; background:#fafafa; }
    .card { background:#fff; border-radius:16px; padding:24px; max-width:520px; margin:auto; box-shadow:0 6px 20px rgba(0,0,0,0.08); }
    h2 { margin-top:0; }
    /* IMPORTANT: this hides non-active pages */
    .page { display: none; }
    .active { display: block; }
    label { font-weight:600; margin-top: 10px; display:block; }
    input[type="email"], input[type="password"], input[type="file"] {
      display:block; margin: 8px 0 16px; padding: 10px; width:100%;
      box-sizing:border-box; border:1px solid #ddd; border-radius:10px;
    }
    button { padding: 12px 18px; border:0; border-radius:12px; cursor:pointer; }
    .primary { background:#2563eb; color:#fff; }
    .row { display:flex; gap:12px; }
    small.note { font-weight:normal; color:#666; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Student Registration</h2>

    <!-- Page 1 (starts visible) -->
    <div id="page1" class="page active">
      <label>Email:</label>
      <input type="email" id="email" required>

      <label>Password:
        <small class="note">(Use a difficult password: â‰¥8 chars with upper/lowercase, numbers, symbols)</small>
      </label>
      <input type="password" id="password" required>

      <label>Confirm Password:</label>
      <input type="password" id="confirmPassword" required>

      <button class="primary" onclick="goToPage2()">Next</button>
    </div>

    <!-- Page 2 (hidden until Next) -->
    <div id="page2" class="page">
      <label>Upload Your CV (PDF/DOC):</label>
      <input type="file" id="cvFile" accept="application/pdf,.doc,.docx">

      <div class="row">
        <button onclick="goBack()">Back</button>
        <button class="primary" onclick="submitForm()">Submit</button>
      </div>
    </div>
  </div>

  <script>
    let savedData = {};
    const BACKEND_URL = "https://SCRIPT_WEB_APP_URL_GOES_HERE"; // replace with your Apps Script Web App URL

    function goToPage2() {
      const email = document.getElementById('email').value.trim();
      const pass = document.getElementById('password').value;
      const confirm = document.getElementById('confirmPassword').value;

      if (!email || !pass || !confirm) { alert('Please fill all fields.'); return; }
      if (pass !== confirm) { alert('Passwords do not match!'); return; }

      // Save as plain text (teaching demo only)
      savedData.email = email;
      savedData.password = pass;

      document.getElementById('page1').classList.remove('active');
      document.getElementById('page2').classList.add('active');
    }

    function goBack() {
      document.getElementById('page2').classList.remove('active');
      document.getElementById('page1').classList.add('active');
    }

    async function submitForm() {
      const cv = document.getElementById('cvFile').files[0];
      if (!cv) { alert('Please upload your CV.'); return; }

      try {
        const fd = new FormData();
        fd.append('email', savedData.email);
        fd.append('password', savedData.password); // plain text
        fd.append('cv', cv, cv.name);

        const res = await fetch(BACKEND_URL, { method: 'POST', body: fd });
        if (!res.ok) throw new Error('Upload failed');

        const data = await res.json();
        console.log('Server response:', data);
        alert('Form submitted and saved!');

        // Reset
        document.getElementById('page2').classList.remove('active');
        document.getElementById('page1').classList.add('active');
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
        document.getElementById('confirmPassword').value = '';
        document.getElementById('cvFile').value = '';
        savedData = {};
      } catch (err) {
        console.error(err);
        alert('Could not save. Check console and BACKEND_URL.');
      }
    }
  </script>
</body>
</html>
